/**
 * jQuery Open plugin
 *
 * @desc Enable to open links in iframe with loading message, in ajax, in current view or in a new window.
 * @desc Add possibility to open content in a confirm or dialog box.
 * @version 1.3.5
 * @author Hervé GOUCHET
 * @author Aurélie Le Bouguennec
 * @use jQuery 1.7+
 * @licenses Creative Commons BY-SA 2.0
 * @see https://github.com/rvflash/jQuery-Open
 * @note Now use Event as only one parameter passed to callback methods.
 *       Event has new property currentHref with url decoded as string inside
 */
(function(e){var t={data:{base:null,id:"_openid",loaded:"_openloaded",loading:"_openloading"},type:{base:null,self:"self",blank:"blank",iframe:"iframe",ajax:"ajax",confirm:"confirm"},popup:{height:780,width:420},confirm:{staticName:"_confirm"},noCloseIdentifier:"noClose",uniqueIdentifier:"unique",visibleIdentifier:"visible",notOutIdentifier:"notouter"};var n={type:t.type.self,container:"body",autoload:false,browser:{name:"_openbrowser",error:{name:"_openfailure",content:"An error was occured. Please to retry later.",enable:true},closure:{name:"_close",content:"X",enable:false,displayed:false},loading:{name:"_openloader",content:"Please be patient, loading ...",enable:true},displayInline:false,outerClosure:false,maxTab:5},ajax:{toggle:true,onLoaded:null,onView:null,onExit:null},iframe:{options:{src:"",scrolling:"auto",frameborder:0},onLoaded:null,onView:null,onExit:null},popup:{options:{scrollbars:"yes",toolbar:"yes",location:"yes",directories:"yes",menubar:"yes",resizable:"yes",status:"yes",top:0,left:0,height:780,width:420},onExit:null},confirm:{title:null,content:null,name:"opConfirm",onSuccess:null,onCancel:null,buttons:{name:"confirmBts",successLabel:"Ok",cancelLabel:"Cancel"},modal:true,modalClass:"modal",autoClose:false,onView:null,onExit:null},window:{onExit:null}};var r=function(n,r){n.preventDefault();n=e.extend(true,{},n);var i=e(n.currentTarget);if("undefined"==typeof i.data(t.data.id)){i.data(t.data.id,"_open"+Math.floor(Math.random()*1001+1))}t.data.base=i.data(t.data.id);if(i.hasClass(t.type.self)){t.type.base=t.type.self}else if(i.hasClass(t.type.blank)){t.type.base=t.type.blank}else if(i.hasClass(t.type.iframe)){t.type.base=t.type.iframe}else if(i.hasClass(t.type.ajax)){t.type.base=t.type.ajax}else{t.type.base=t.type.self}if(null!=(n.currentHref=d(i,r))){switch(t.type.base){case t.type.ajax:return o(n,r);case t.type.iframe:return u(n,r);case t.type.blank:return a(n,r);case t.type.self:default:return f(n,r)}}if(r.type==t.type.confirm){t.type.base=t.type.confirm;return l(n,r)}return false};var i=function(n,r){if(e.isFunction(r[r.type].onExit)){r[r.type].onExit(n)}e(n.currentTab).hide().removeClass(t.visibleIdentifier);var i=e("#"+r.browser.name);if(0==i.children("."+t.visibleIdentifier).length){i.removeClass(t.data.loaded)}if(i.hasClass(r.confirm.modalClass)){i.removeClass(r.confirm.modalClass)}};var s=function(n,r,s){if(true==e("div."+t.visibleIdentifier).hasClass(t.noCloseIdentifier))return false;var o=e(n.target);var u=e("#"+s.browser.name+" div."+t.visibleIdentifier);if(0<u.length&&0==o.closest("."+t.notOutIdentifier).length){r=o.parents(r).first();if(0<r.length){o=r}if(null==(r=o.data(t.data.id))){r=e("#"+r)}if(0==r.length&&o[0]!=u[0]&&0==o.parents("#"+u.attr("id")).length){if(u.children("iframe").length){t.type.base=t.type.iframe}else if(u.hasClass(t.confirm.staticName)){t.type.base=t.type.confirm}else{t.type.base=t.type.ajax}n.currentTab=u[0];i(n,s)}}};var o=function(n,r){if(null==e("#"+r.name).data(t.data.loading)){c(r);if(null==e("#"+t.data.base).data(t.data.loaded)){e("#"+r.name).data(t.data.loading,true);return e.get(n.currentHref,function(n){e("#"+r.name).data(t.data.loading,false);e("#"+t.data.base).append(n)}).success(function(){h(n,r)}).error(function(){if(r.browser.error.enable){e("#"+r.browser.error.name).show().delay(1e3).hide()}})}return h(n,r)}};var u=function(n,r){c(r);if(null==e("#"+t.data.base).data(t.data.loaded)){var i=[];for(var s in r.iframe.options){i.push(s+' = "'+r.iframe.options[s]+'"')}e("#"+t.data.base).append("<iframe "+i.join(" ")+"></iframe>")}var o=e("#"+t.data.base+" > iframe");if(r.browser.loading.enable){if(""==o.attr("src")){return o.attr("src",n.currentHref).load(function(){h(n,r)})}}else if(""==o.attr("src")){o.attr("src",n.currentHref)}return h(n,r)};var a=function(n,r){var i=[];var s=r.popup.options;s.height=screen.height*.8;s.width=screen.width*.8;if(s.width<t.popup.height){s.height=t.popup.height}if(s.height<t.popup.width){s.width=t.popup.width}for(var o in s){i.push(o+"="+s[o])}if(e.isFunction(r.popup.onExit)){r.popup.onExit(r.popup.name)}return window.open(n.currentHref,t.data.base,i.join(","))};var f=function(t,n){if(e.isFunction(n.window.onExit)){n.window.onExit(t)}return window.location.href=t.currentHref};var l=function(n,r){c(r);var s=e("#"+t.data.base);if(s.children("."+t.type.confirm+"Content").length==0){s.addClass(r.confirm.name).addClass(t.confirm.staticName);if(null==r.confirm.content)return false;if(null!=r.confirm.title){var o=e('<h1 class="'+t.type.confirm+'Title">'+r.confirm.title+"</h1>");s.append(o)}s.append('<div class="'+t.type.confirm+'Content">'+r.confirm.content+"</div>");var u=n;var a=r;if(null!=r.confirm.onSuccess){s.addClass(t.noCloseIdentifier);var f=e('<div class="'+r.confirm.buttons.name+'"></div>');var l=e('<button class="cfOk">'+r.confirm.buttons.successLabel+"</button>");f.append(l);l.click(function(t){if(e.isFunction(a.confirm.onSuccess)){a.confirm.onSuccess(u)}i(u,a)});var p=e('<button class="cfCancel">'+r.confirm.buttons.cancelLabel+"</button>");f.append(p);p.click(function(t){if(e.isFunction(a.confirm.onCancel)){a.confirm.onCancel(u)}i(u,a)});s.append(f)}}var d=e("#"+r.browser.name);if(r.confirm.modal)d.addClass(r.confirm.modalClass);if("number"==typeof r.confirm.autoClose){setTimeout(function(){i(u,a)},a.confirm.autoClose)}return h(n,r)};var c=function(n){if(0==e("#"+n.browser.name).length){e(document.body).append('<div id="'+n.browser.name+'"></div>')}if(n.browser.loading.enable){if(0==e("#"+n.browser.loading.name).length){e(document.body).append('<div id="'+n.browser.loading.name+'">'+n.browser.loading.content+"</div>")}else{e("#"+n.browser.loading.name).show()}}if(n.browser.error.enable){if(0==e("#"+n.browser.error.name).length){e(document.body).append('<div id="'+n.browser.error.name+'">'+n.browser.error.content+"</div>")}e("#"+n.browser.error.name).hide()}if(0==e("#"+t.data.base).length){var r=e("#"+n.browser.name+" > div");if(n.browser.maxTab<=r.length){r.filter(":first").remove()}var i="";if(n.browser.closure.enable||n.browser.closure.displayed){i='<div class="'+n.browser.closure.name+'">'+n.browser.closure.content+"</div>"}e("#"+n.browser.name).append('<div id="'+t.data.base+'">'+i+"</div>")}e("#"+n.browser.name+" > div").hide()};var h=function(n,r){if(r.browser.loading.enable){e("#"+r.browser.loading.name).hide()}var s=e("#"+t.data.base);n.currentTab=s[0];if(t.type.ajax==t.type.base&&r.ajax.toggle&&s.hasClass(t.visibleIdentifier)){i(n,r)}else{e("#"+r.browser.name).addClass(t.data.loaded);if(r.browser.displayInline){s.show()}else{s.css("display","block")}s.addClass(t.visibleIdentifier);if(null==s.data(t.data.loaded)){if(e.isFunction(r[t.type.base].onLoaded)){r[t.type.base].onLoaded(n)}s.data(t.data.loaded,true)}if(e.isFunction(r[t.type.base].onView)){r[t.type.base].onView(n)}}if(r.browser.closure.enable||r.browser.closure.displayed){e(n.currentTab).find("."+r.browser.closure.name).data("base",{data:t.data.base,type:t.type.base})}};var p=function(e){var t=new String;var n,r,i,s=new String;n="a";r="A";i="z";s="Z";var o=-1,u;while(o++<e.length-1){u=e.charCodeAt(o);if(u>=n.charCodeAt()&&u<=i.charCodeAt()){u=(u-n.charCodeAt()+13)%26+n.charCodeAt()}else if(u>=r.charCodeAt()&&u<=s.charCodeAt()){u=(u-r.charCodeAt()+13)%26+r.charCodeAt()}t+=String.fromCharCode(u)}return t};var d=function(e,n){var r;if(null!=(r=v(e))){if(t.type.ajax==t.type.base&&-1!=r.indexOf("#")){r=r.replace("#",-1!=r.indexOf("?")?"&":"?")}if(null!=e.data("arg")){r+=(-1!=r.indexOf("?")?"&":"?")+e.data("arg")}if(e.hasClass(t.uniqueIdentifier)){r+=(-1!=r.indexOf("?")?"&":"?")+"_i="+(new Date).getTime()}}return r};var v=function(t){if("undefined"!==typeof t.attr("href")){return t.attr("href")}else if("undefined"!==typeof t.data("url")){return t.data("url")}else if("undefined"!==typeof t.data("erl")){return p(t.data("erl"))}else if("undefined"!==typeof t.data("nrl")){var n=t.data("nrl");if(-1!==n.indexOf("uggc:")||-1!==n.indexOf("uggcf:")){return p(n)}return n}else if("undefined"!==typeof t.data("irl")){return v(e("#"+t.data("irl")))}return null};e.open=function(o,u){var a;if("undefined"!=typeof u){a=e.extend(true,{},n,u)}else{a=n}e(a.container).on("click",o,function(e){r(e,a)}).on("click","#"+a.browser.name+" ."+a.browser.closure.name,function(n){if(a.browser.closure.enable){n.currentTab=e(this).parent();if(e(n.currentTab).children("iframe").length){a.type=t.type.iframe}else{a.type=t.type.ajax}if(undefined!=e(this).data("base")){var r=e(this).data("base");if(undefined!=r.type)a.type=r.type;if(undefined!=r.type)a.data=r.data}i(n,a)}}).on("click",function(e){if(a.browser.outerClosure){s(e,o,a)}});if(a.autoload){var f=e.Event("click");f.currentTarget=e(o).filter(":first");r(f,a)}}})(jQuery)
